# 8월 25일

각자 역할분담해서 간단하게 만들고 서로 확인하기로 하고 작업에 착수했다.

1. API 만들기
2. 테이블 설계
3. 개발 서버구축, 포트포워딩

### 프론트엔드 서버를 요청받을 API서버 구축하기

처음에는 기존에 코드스테이츠에서 학습했던 AWS 사용을 고려했으나, 비용이 많이 나올시 감당할 수 없을것 같다는 의견이 있어. 다른 대체제를 찾았다.

그리하여 찾아낸 “Heroku”가 가장 적합할것이라 생각했지만, 12일 짜리 프로젝트에 새로운걸 배우면서 도입 하기에는 시간이 부족할 수 있다는 의견이 있었다.

최종적으로 나의 컴퓨터에 Tomcat서버를 구축해서 사용하기로 결정했다.

### 톰캣 서버 구축

프론트엔드 측에서 사용할 수 있는 개발 서버를 내 컴퓨터에 배포해놓기 위해 외장 Tomcat을 사용하고 나 또한 계속해서 구현해나갈 백엔드코드가 작동하는지 테스트하기 위해 SpringBoot에 내장된 Tomcat을 활용하기로 결정했다.

공식홈페이지에서 Tomcat 9.0버전을 설치한 후 바로 실행시켜보았다.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/baceb6da-bd68-4fb5-9c75-1060ac06bf46/Untitled.png)

P1. 시작부터 글씨가 깨져나오고 실행이 되지 않아 문제가 생겼었다.

Sol) 한글을 인코딩 할 수 없어 발생하는 문제였기 때문에 간단하게 인코딩을 수정해 주었다.

경로 : Tomcat 9.0/conf/logging.properties

```java
java.util.logging.ConsoleHandler.level = FINE
java.util.logging.ConsoleHandler.formatter = org.apache.juli.OneLineFormatter
java.util.logging.ConsoleHandler.encoding = EUC-KR // UTF-8 -> EUC-KR로 변경
```

P2. 한글로 인코딩을 되게 바꾸어보니, 8080번 포트가 이미 사용되고 있었다.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/18b26bb2-c703-4828-9aab-d6b96bb24172/Untitled.png)

Sol) 8080포트를 찾아서 제거해 주었다.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/9881af7b-7aeb-48e2-8074-35164d431aae/Untitled.png)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/a420decc-a344-4637-81b0-8c432ee514e7/Untitled.png)

### 외부와 내부를 이어주는 포트포워딩

위의 작업을 마치면 잘 작동하는것을 확인할 수 있고, localhost:8080에서 톰캣이 실행되는지 또한 확인할 수 있다.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/152d5ba7-fc86-4558-be80-32ae58918003/Untitled.png)

localhost뿐만아니라 내부아이피 주소와 포트로도 접속이 가능한것을 확인할 수 있다.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f1640b17-02bd-4d4b-a37c-74f060a56634/Untitled.png)

이 아이피로 접속이 되는지는 내부와 외부가 연결될때 사용되므로 중요하다.

이때, 외부에서 8080으로 접속 요청이 들어왔을때, 내부아이피의 8080포트로 보내겠다고 규칙을 정하는것이 “포트 포워딩”이다.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/6c9ac753-759f-45a9-a607-7bb25876faa7/Untitled.png)

예시를 들어보자.

ex) 183.103.101.123:8080 공인아이피 주소로 외부포트 8080에 요청이 들어왔다고 가정하자.

난 프론트엔드 측에서 외장 Tomcat서버에 접근하도록 만들고싶다.

그렇다면 183.103.101.123:8080 요청이 들어오면 172.30.1.33:8080으로 들어가도록 약속을 정의하는것이다.

이는 각자 공유기에서 설정할 수 있다.

KT 공유기로 직접 포트 포워딩을 한 예시이다.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/d8ce5a3d-4e8b-4276-8140-d9b97501beb0/Untitled.png)

추가 버튼을 누르면 아래 사진 처럼 등록됨을 확인할 수 있다.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/b3646dfe-aff4-40ee-9f4a-a3cc3309db46/Untitled.png)

이렇게 포트 포워딩을 완료한다면, 공인아이피 주소로도 들어갈 수 있는것을 확인할 수 있다.

![공인아이피 주소.jpg](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/11d53a34-6101-426c-b3ca-a1ec91e1e6d9/%EA%B3%B5%EC%9D%B8%EC%95%84%EC%9D%B4%ED%94%BC_%EC%A3%BC%EC%86%8C.jpg)

## 간단하게 서비스 만들고 테스트 !

간단하게 API가 잘 작동하는지 확인하기 위해 [https://start.spring.io/](https://start.spring.io/)에서 Dependencies에 Spring Web만 추가후 코드를 작성해 보았다.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/b1ede881-df56-4590-a9b2-b1afb6469522/Untitled.png)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/af5991b7-2e18-4bae-a445-3df2d61efbf0/Untitled.png)

아주 간단하게 Controller 테스트만 만들어준다.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/0829e5ee-77de-47d1-bc17-3d1d6ba23259/Untitled.png)

### 외부 톰캣에 Spring 서버 띄우기

외부 톰캣에 Spring서버를 띄우기 위해서는 SpringBootServletInitalizer의 상속이 필요하다.

```java
@SpringBootApplication
public class DemoApplication extends SpringBootServletInitializer {

   @Override // 추가해줌
   protected SpringApplicationBuilder configure(SpringApplicationBuilder application) {
      return application.sources(DemoApplication.class);
   }

   public static void main(String[] args) {
      SpringApplication.run(DemoApplication.class, args);
   }
}
```

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/2c5af63d-5ff7-4bba-85aa-e7afb30ad9cc/Untitled.png)

톰캣에서는 배포를 할때 War 파일을 주로 사용하므로 Intellij에서 War를 빌드해 주려면 따로 build.gradle에 코드를 추가해주어야한다.

방법1. id ‘war’를 추가하는 방법

```
plugins{
id 'org.springframework.boot' version '2.7.3'
   id 'io.spring.dependency-management' version '1.0.13.RELEASE'
   id 'java'
   id 'war' //추가됨.
}
```

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/d76e65a5-42d4-441d-9fed-8f48b27c7456/Untitled.png)

방법2. apply plugin: ‘war’를 추가하는 방법

```
group = 'com.example'
version = '0.0.1-SNAPSHOT'
sourceCompatibility = '11'
apply plugin:'war' // 추가됨
```

두가지 중 어떤 방법을 선택해도 상관이 없다.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/543a8c74-e86e-4ab7-9289-d4825df3fe32/Untitled.png)

추가후 Load Gradle Changes(Ctrl + Shift + O)를 해주면 아래와 같은 항목이 추가되는것을 확인할 수 있다.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/640ce47d-1ad8-46a1-b1b0-0953cc0a6fa4/Untitled.png)

빌드를 실행 시키면 위와 같은 코드가 작성됨을 확인할 수 있다.

이때 bootWar Task로 빌드하면 내장용 톰캣으로 실행할 수 있는 war가 생성된다.

하지만 war Task로 빌드하면 외장용 톰캣에서만 실행할 수 있는 빌드파일이 만들어진다.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/b1226d31-9977-4a15-80f0-e48df58b7af9/Untitled.png)

plain이 붙어있는 war파일이 외장용이다.

다음과 같은 파일이 생성된다.

이 demo-0.0.1-SNAPSHOT.war파일을 Tomcat을 설치한 폴더내의 webapps에 넣어준다.

그리고 

### API 요청이 잘 가는지 확인하기

API 요청을 확인하는 도구인 Postman을 사용해서 Get 요청과 Post 요청이 제대로 되는지 확인할 수 있다.

1. GET요청

공인아이피에 포트를 적고 Send 버튼을 클릭하자. 

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/634f5c94-be96-4109-9788-cabf5a0c490a/Untitled.png)

아래 Body에 “home”이 출력되는것을 확인할 수 있다.

1. POST요청

공인아이피에 포트를 적고 Send 버튼을 클릭하자

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/cbd8a023-8920-46ee-8624-078bb1b0c03c/Untitled.png)

Post 요청도 잘 받아오는것을 확인할 수 있다.
